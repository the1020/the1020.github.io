---
title: ì°¸ì¡° íƒ€ì…ì˜ ë¶ˆë³€ì„± ì•Œì•„ë³´ê¸°
author: ì˜ˆì€
date: 2022-08-01 18:50:00 +0900
categories: [study]
tags: [REACT, JAVASCRIPT, ë¶ˆë³€ì„±, ìƒíƒœê´€ë¦¬]
---

### ë¶ˆë³€ì„±(Immutable)

ğŸ”– ë¶ˆë³€ì„±ì´ë€ ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

ğŸ”– ë¶ˆë³€ì„±ì„ ì§€í‚¤ë©´ `1. ë¬´ë¶„ë³„í•œ ìƒíƒœì˜ ë³€ê²½ì„ ë§‰ì„ ìˆ˜ ìˆê³ ` `2.ìƒíƒœì˜ ë³€ê²½ì„ ì¶”ì í•˜ê¸°ê°€ ì‰½ë‹¤`.

ğŸ”– ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì›ì‹œ íƒ€ì…ì€ ë¶ˆë³€ì„±ì„ ê°€ì§€ì§€ë§Œ ì°¸ì¡° íƒ€ì…ì€ ê·¸ë ‡ì§€ ì•Šë‹¤. ì°¸ì¡° íƒ€ì…ì˜ ê°ì²´ì˜ ê²½ìš° ë©”ëª¨ë¦¬ í™ ì˜ì—­ì— ì €ì¥ì´ ë˜ì–´ ë‚´ë¶€ í”„ë¡œí¼í‹°ë¥¼ ë³€ê²½í•´ë„ ê°™ì€ ì°¸ì¡°ë¥¼ ê°–ê³  ìˆë‹¤. ë”°ë¼ì„œ ê°ì²´ì˜ íŠ¹ì • í”„ë¡œí¼í‹°ë§Œ ë³€ê²½í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰ í›„ ë‹¤ë¥¸ ê°ì²´ë¡œ ì¸ì‹ë˜ì§€ ì•ŠëŠ”ë‹¤.

ğŸ”– `Object.assign()` ë©”ì„œë“œë¥¼ ì´ìš©í•˜ê±°ë‚˜ ES6ì˜ `ìŠ¤í”„ë ˆë“œ ì—°ì‚°ì`ë¥¼ ì´ìš©í•˜ì—¬ ì´ì „ ì°¸ì¡°ì™€ ë‹¤ë¥¸ ì°¸ì¡°ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ê°ê°ì˜ ë©”ëª¨ë¦¬ ê³µê°„ì— í• ë‹¹ë˜ì–´ ë‹¤ë¥¸ ê°ì²´ë¡œ ì¸ì‹ëœë‹¤. í•˜ì§€ë§Œ ë‘ ê°€ì§€ ë°©ë²• ëª¨ë‘ **ì–•ì€ ë³µì‚¬**ë¥¼ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— ë‚´ë¶€ì˜ í”„ë¡œí¼í‹°ê°€ ì°¸ì¡°ì¸ ê²½ìš° ì°¸ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì—¬ ì™„ì „íˆ ë‹¤ë¥¸ ì°¸ì¡°ê°€ ë˜ì§€ëŠ” ëª»í•œë‹¤.

### ë¦¬ì•¡íŠ¸ì—ì„œì˜ ë¶ˆë³€ì„±ê³¼ ë Œë”ë§

ğŸ”– ë¦¬ì•¡íŠ¸ëŠ” propsë‚˜ stateê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§í•˜ëŠ”ë° ë³€ê²½ëœ ì‚¬ì‹¤ì€ ë¶ˆë³€ì„±ì„ ì´ìš©í•´ì„œ ê°ì§€í•œë‹¤. ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ë³µì‚¬í•œë‹¤ëŠ” ì ì„ ì´ìš©í•´ ë‹¨ìˆœíˆ ì°¸ì¡°ë§Œ ë¹„êµí•˜ëŠ” ì–•ì€ ë¹„êµë¥¼ ì´ìš©í•´ì„œ ë³€ê²½ì´ ì¼ì–´ë‚¬ëŠ”ì§€ í™•ì¸í•œë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— [ì§ì ‘ stateë¥¼ ìˆ˜ì •í•´ì„œëŠ” ì•ˆëœë‹¤.](https://ko.reactjs.org/docs/state-and-lifecycle.html#using-state-correctly)

### ë¶ˆë³€ì„± ìœ ì§€ë¥¼ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ (immer)

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë ¤ë©´ `Object.assign()` ë©”ì„œë“œ ë˜ëŠ” ES6ì˜ `ìŠ¤í”„ë ˆë“œ ì—°ì‚°ì`ë¥¼ ì´ìš©í•´ì•¼ í•˜ëŠ”ë° ì´ë§ˆì €ë„ ì–•ì€ ë³µì‚¬ë¥¼ ìˆ˜í–‰í•˜ë¯€ë¡œ ê°ì²´ì˜ í”„ë¡œí¼í‹°ê°€ ì°¸ì¡° íƒ€ì…ì´ë©´ ì¬ê·€ë¥¼ í†µí•´ ë³µì‚¬ë¥¼ í•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìƒê¸´ë‹¤.

`immer`ëŠ” ì´ë¥¼ ëŒ€ì‹ í•˜ì—¬ ë¶ˆë³€ ê°ì²´ë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.

### React + Immer

ë¦¬ì•¡íŠ¸ì˜ `useState`ì™€ `useReducer` ë‚´ë¶€ì— ì €ì¥ëœ ìƒíƒœ ê°’ë“¤ì€ ë¶ˆë³€ì„±ì„ ì§€ë‹Œë‹¤. ë”°ë¼ì„œ ì§ì ‘ì ìœ¼ë¡œ ìƒíƒœ ê°’ì„ ë³€ê²½í•˜ì§€ ì•Šê³  setStateë¥¼ ì´ìš©í•˜ë©° ë³€ê²½í•˜ê³ ì í•˜ëŠ” ìƒíƒœ ê°’ì€ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•œ ë’¤ ì—…ë°ì´íŠ¸ë¥¼ ìš”ì²­í•œë‹¤.

```javascript
const changeState = (newItem) => {
    //1ï¸âƒ£ ìƒˆë¡œìš´ ê°ì²´ë¡œ ê°±ì‹ í•œë‹¤.
    setState(newItem);

    //2ï¸âƒ£ updateStateë¼ëŠ” í”„ë¡œí¼í‹°ë§Œ ê°±ì‹ í•œë‹¤.
    setState((prevState) => { ...prevState, updateState : updatedValue});
}
```

immerì˜ produce í•¨ìˆ˜ë¥¼ useStateì™€ useReducerì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì „ë‹¬í•˜ì§€ ì•Šê³  íŒŒë¼ë¯¸í„°ë¡œ ë°›ì€ ì›ë˜ì˜ ìƒíƒœ ê°’ì„ ë³€ê²½í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

### useReducer + Immer

ì–´ì œ ë¦¬ì•¡íŠ¸ ê°•ì˜ì—ì„œ ë§Œë“¤ì—ˆë˜ [Practice Project](https://codesandbox.io/s/building-a-food-order-app-dodgfg?file=/src/store/CartProvider.js)ì—ì„œ ì¥ë°”êµ¬ë‹ˆ ì»´í¬ë„ŒíŠ¸ì—ì„œ `useReducer`ë¡œ ìƒíƒœ ê°’ì„ ê´€ë¦¬í•˜ê³  ìˆë‹¤. ì´ ë¶€ë¶„ì„ immerë¥¼ ì‚¬ìš©í•œ ì½”ë“œë¡œ ë³€ê²½í•´ë³´ê¸°ë¡œ í–ˆë‹¤.

#### ê¸°ì¡´ ì¥ë°”êµ¬ë‹ˆ ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœ ê´€ë¦¬

![cart-component-state](/assets/img/post/TIL/20220801/cart-component-state.png)

ì¥ë°”êµ¬ë‹ˆì˜ ì•„ì´í…œ ëª©ë¡ì€ ìœ„ì™€ ê°™ì€ ìƒíƒœ ê°’ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ëª©ë¡ì€ ë°°ì—´ë¡œ ê´€ë¦¬í•˜ê³  ê° ìš”ì†Œë“¤ì€ ê°ì²´ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.

ì¥ë°”êµ¬ë‹ˆì— ìƒˆ ì•„ì´í…œì´ ì¶”ê°€í•˜ë©´ ê¸°ì¡´ ì•„ì´í…œ ëª©ë¡(`items`)ì— ë™ì¼í•œ ì•„ì´í…œì´ ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆë‹¤ë©´ ê·¸ ê°ì²´ì˜ ìˆ˜ëŸ‰(`amount`) í”„ë¡œí¼í‹° ê°’ë§Œ ì¦ê°€ì‹œì¼œ ì—…ë°ì´íŠ¸í•œë‹¤. ê¸°ì¡´ ì½”ë“œì—ì„œ amount ìƒíƒœ ê°’ ê°±ì‹ ê³¼ ê´€ë ¨ì´ ì—†ëŠ” êµ¬ë¬¸ë“¤ì€ ìƒëµí•˜ì˜€ë‹¤.

![cart-reducer](/assets/img/post/TIL/20220801/cart-reduce.gif)

```javascript
//âš ï¸ ë¦¬ë“€ì„œ í•¨ìˆ˜ëŠ” í˜¸ì¶œë˜ëŠ” ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œ ì„ ì–¸í•´ë„ ë˜ë¯€ë¡œ CartProvider ì™¸ë¶€ì—ì„œ ì„ ì–¸í•˜ì˜€ìŒ
const reducerFn = (state, action) => {
  if (action.type === "ADD") {
    const existedItem = state.items[existedItemIndex];
    const updateItem = {
      ...existedItem,
      amount: existedItem.amount + action.payload.amount,
    };

    const updateItems = [...state.items];
    updateItems[existedItemIndex] = updateItem;

    return { items: updateItems, totalAmount: updatedTotalAmount };
  }
};

const CartProvider = (props) => {
  const [cartState, dispatchAction] = useReducer(reducerFn, defaultState);

  const addItemCartToHandler = (newItem) => {
    dispatchAction({ type: "ADD", payload: newItem });
  };
};
```

ì¥ë°”êµ¬ë‹ˆì— ë¬¼í’ˆì´ ì¶”ê°€í•´ì„œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ `addItemCartToHandler`ì´ í˜¸ì¶œë˜ë©´ì„œ ë¦¬ë“€ì„œ í•¨ìˆ˜(`reducerFn`)ê°€ ì‹¤í–‰ëœë‹¤.

`items`ë¼ëŠ” ìƒíƒœëŠ” ì°¸ì¡° íƒ€ì… ë‚´ì— ì°¸ì¡° íƒ€ì…ì„ ê°€ì§€ê³  ìˆëŠ” êµ¬ì¡°ë‹¤.(ê°ì²´ë¥¼ ìš”ì†Œë¡œ ê°–ëŠ” ë°°ì—´)

ê·¸ë ‡ê¸° ë•Œë¬¸ì— `items` ê°ì²´ë¥¼ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¥¼ ì´ìš©í•´ ìƒˆ ê°ì²´ë¥¼ ìƒì„±í•˜ë”ë¼ë„ ë‚´ë¶€ ì°¸ì¡°ëŠ” ë™ì¼í•œ ê°’ì„ ê°€ë¦¬í‚¨ë‹¤.

```javascript
const copyItems = [...state.items];
console.log(state.items[0] === copyItems[0]); // true
```

ì—¬ê¸°ì„œ ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì˜ ìˆœì„œëŒ€ë¡œ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

1. ì—…ë°ì´íŠ¸ í•  ìš”ì†Œë¥¼ ì°¾ì•„ `amount`ê°’ì„ ë³€ê²½í•œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. (Line 4 ~ 8)
   - ë°°ì—´ì˜ ì¸ë±ìŠ¤ë¡œ ì—…ë°ì´íŠ¸í•  ë°°ì—´ì˜ ìš”ì†Œë¥¼ ì°¾ì€ í›„ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ ìƒˆ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ `updateItem`ì— í• ë‹¹í•œë‹¤.
2. ê·¸ í›„ì— `items`ë¥¼ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ ìƒˆ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. (Line 10 ~ 11)
   - ì´ì „ ìƒíƒœ ê°’ê³¼ ë‹¤ë¥¸ ì°¸ì¡° ê°’ì„ ë°˜í™˜í•´ì•¼ í•˜ë¯€ë¡œ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¥¼ ì´ìš©í•˜ì—¬ `updateItems`ë¼ëŠ” ë³€ìˆ˜ì— ìƒˆë¡œìš´ ê°ì²´ë¥¼ í• ë‹¹í•œë‹¤. ê·¸ë¦¬ê³  1ë²ˆì—ì„œ ì‘ì—…í•œ `updateItem` ìš”ì†Œë¥¼ ì—…ë°ì´íŠ¸í•´ì¤€ë‹¤.

ì´ì²˜ëŸ¼ ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•œë‹¤. ì´ ë¶€ë¶„ì„ immerë¡œ ëŒ€ì²´í•´ë³´ì.

#### immerì˜ produce í™œìš©í•˜ê¸°

ì‚¬ìš© ë°©ë²•ì€ [Immer ê³µì‹ ë¬¸ì„œ](https://immerjs.github.io/immer/example-setstate#usereducer--immer)ë¥¼ ì°¸ê³ í•˜ì˜€ë‹¤.

```javascript
const reducerFn = produce((draft, action) => {
  if (action.type === "ADD") {
    const existedItem = draft.items[existedItemIndex];
    existedItem.amount += action.payload.amount;
  }
});

const CartProvider = (props) => {
  const [cartState, dispatchAction] = useReducer(reducerFn, defaultState);
  /* ... */
};
```

immerì˜ produce í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ë¦¬ë“€ì„œ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•œë‹¤.

ì´ ë•Œ ë¦¬ë“€ì„œ í•¨ìˆ˜ëŠ” ì›ë˜ ìƒíƒœ ê°’ì¸ `draft`ì™€ dispatch í•¨ìˆ˜ê°€ ë³´ë‚¸ `action` ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤. itemsì—ì„œ ì—…ë°ì´íŠ¸ í•  í•­ëª©ì„ ì°¾ì€ í›„ ì¬í• ë‹¹í•  í•„ìš”ì—†ì´ ë°”ë¡œ ê°’ì„ ê°±ì‹ í•´ì£¼ë©´ ëœë‹¤.

### useImmerReducer

`useImmer` íŒ¨í‚¤ì§€ì˜ `useImmerReducer`ëŠ” ë” ê°„ë‹¨í•˜ê²Œ immerë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

useReducer ëŒ€ì‹  useImmerReducerë¥¼ ì‚¬ìš©í•˜ë©´ produce í•¨ìˆ˜ë¥¼ ìƒëµí•˜ê³  ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•´ì¤˜ë„ ë™ì¼í•˜ê²Œ ë™ì‘í•œë‹¤.

```javascript
const reducerFn = (draft, action) => {
  if (action.type === "ADD") {
    const existedItem = draft.items[existedItemIndex];
    existedItem.amount += action.payload.amount;
  }
};

const CartProvider = (props) => {
  const [cartState, dispatchAction] = useImmerReducer(reducerFn, defaultState);
  /* ... */
};
```

### ë§ˆë¬´ë¦¬

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¶ˆë³€ì„± ìœ ì§€ë¥¼ ì‰½ê²Œ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” immer ì´ ì™¸ì—ë„ [lodashì˜ cloneDeep](https://lodash.com/docs/4.17.15#cloneDeep), [immutable-js](https://immutable-js.com/) ë“±ì´ ìˆë‹¤.

ë§¤ë²ˆ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ ì–•ì€ ë³µì‚¬ë¥¼ í•œ ë’¤ ìƒˆ ê°ì²´ë¥¼ ë°˜í™˜í•´ì£¼ê±°ë‚˜ ê¹Šì€ ë³µì‚¬ í•¨ìˆ˜ë¥¼ êµ¬ê¸€ë§í•´ì„œ ì‚¬ìš©í–ˆëŠ”ë° ì´ëŸ° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ìˆ˜ì›”í•˜ê²Œ ì‘ì—…í•  ìˆ˜ ìˆì„ ê±° ê°™ë‹¤.
ìœ„ì—ì„œ ì‘ì—…í•œ ê²ƒì²˜ëŸ¼ ì½”ë“œë„ êµ‰ì¥íˆ ê°„ë‹¨í•´ì ¸ì„œ ê°€ë…ì„±ë„ í›¨ì”¬ ì¢‹ë‹¤.

> ğŸ ì°¸ê³ 
>
> - [ë¶ˆë³€ ê°ì²´ì™€ immer](https://ui.toast.com/weekly-pick/ko_20220217)
>
> - [ë³€í•˜ì§€ ì•ŠëŠ” ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ë°©ë²•, ë¶ˆë³€ì„±(Immutable)](https://evan-moon.github.io/2020/01/05/what-is-immutable/)
>
> - [immer ê³µì‹ ë¬¸ì„œ](https://immerjs.github.io/immer/)
